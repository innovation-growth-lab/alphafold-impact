_js: &_js
  type: ${_json.type}
  credentials: s3_credentials

_pq: &_pq
  type: pandas.ParquetDataset
  credentials: s3_credentials
  load_args:
    engine: pyarrow

# Raw Gateway to Research data - includes projects, publications, organisations and funds 

"{source}.collection.{label}.raw":
  <<: *_js
  filepath: s3://alphafold-impact/data/01_raw/{source}/{label}.json

# Intermediate Gateway to Research data - includes projects, publications, organisations and funds

"{source}.collection.{label}.intermediate":
  <<: *_pq
  filepath: s3://alphafold-impact/data/02_intermediate/{source}/{label}.parquet

# OpenAlex data from publications in Gateawy to Research

gtr.enrichment.publications.oa.dict:
  <<: *_js
  filepath: s3://alphafold-impact/data/02_intermediate/gtr/outcomes/publications/oa/doi_oaid.json

gtr.enrichment.publications.oa.tmp:
  <<: *_js
  path: s3://alphafold-impact/data/00_tmp/gtr/outcomes/publications/oa/
  type: partitions.PartitionedDataset
  dataset: ${_json.type}
  filename_suffix: ".json"

# OpenAlex data from citations of publications in Gateway to Research

gtr.enrichment.publications.oa.citations:
  <<: *_js
  path: s3://alphafold-impact/data/02_intermediate/gtr/outcomes/publications/oa/citations/
  type: partitions.PartitionedDataset
  dataset: ${_json.type}
  filename_suffix: ".json"

# Openalex data from works in Gateway to Research

works_for_concepts:
  type: ${_json.type}
  filepath: s3://alphafold-impact/data/01_raw/openalex/works/works_for_concepts.json
  credentials: s3_credentials

oa_raw_works_for_concepts_and_years:
  type: kedro_datasets.pandas.JSONDataset
  filepath: s3://alphafold-impact/data/01_raw/openalex/works/oa_works_for_concepts_and_years.json
  credentials: s3_credentials

works_for_concepts:
  type: ${_json.type}
  filepath: s3://alphafold-impact/data/01_raw/openalex/works/works_for_concepts.json
  credentials: s3_credentials

_work_citations: &_work_citations
  type: partitions.PartitionedDataset
  dataset: ${_json.type}
  filename_suffix: ".json"
  credentials: s3_credentials

works_incoming_citations:
  <<: *_work_citations
  path: s3://alphafold-impact/data/02_intermediate/openalex/works/cites/

works_outgoing_citations:
  <<: *_work_citations
  path: s3://alphafold-impact/data/02_intermediate/openalex/works/cited_by/
  
downstream_incoming_citations:
  type: partitions.PartitionedDataset
  dataset: ${_json.type}
  filename_suffix: ".json"
  path: "s3://alphafold-impact/data/02_intermediate/openalex/works/downstream/${runtime_params:get.work_id, undefined}/" # else option is always string...
  credentials: s3_credentials